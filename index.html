<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generating Report...</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        /* === RESET & BASICS === */
        * { box-sizing: border-box; }
        
        :root {
            --bg: #333;
            --paper: #ffffff;
            --text-main: #111;
            --text-light: #555;
            --accent: #000;
        }

        body {
            background: var(--bg);
            /* SYSTEM FONTS for 100% PDF Reliability */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0; padding: 20px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-height: 100vh;
        }

        #statusOverlay {
            position: fixed; top: 0; left: 0; right: 0;
            background: #000; color: #fff; padding: 15px; text-align: center;
            font-size: 14px; z-index: 999; font-weight: bold;
        }

        /* === A4 PAPER CONTAINER === */
        .manifest-paper {
            background: var(--paper);
            width: 210mm; min-height: 297mm; /* A4 Exact */
            padding: 40px;
            margin: 0 auto;
            position: relative;
            color: var(--text-main);
            /* Important for PDF */
            box-shadow: none; 
        }

        /* === REPORT STYLES === */
        .doc-header { 
            display: flex; justify-content: space-between; align-items: flex-start; 
            border-bottom: 3px solid #000; padding-bottom: 20px; margin-bottom: 30px; 
        }
        
        .brand-section h1 { font-size: 26px; font-weight: 900; margin: 0; text-transform: uppercase; letter-spacing: -0.5px; }
        .brand-section .subtitle { font-size: 10px; color: var(--text-light); letter-spacing: 1px; text-transform: uppercase; margin-top: 5px; display: block; font-weight: 600; }
        
        .meta-box { text-align: right; font-family: 'Courier New', Courier, monospace; font-size: 10px; color: #333; line-height: 1.5; font-weight: bold; }
        .status-tag { display: inline-block; background: #000; color: #fff; padding: 4px 8px; font-weight: bold; font-size: 9px; text-transform: uppercase; margin-bottom: 8px; }

        /* GRID */
        .tech-grid { 
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 30px; 
            border: 1px solid #ccc; padding: 15px; background: #f9f9f9; 
        }
        .data-point label { display: block; font-size: 8px; text-transform: uppercase; color: #666; font-weight: bold; margin-bottom: 4px; }
        .data-point div { font-family: 'Courier New', Courier, monospace; font-size: 11px; font-weight: bold; color: #000; }

        /* HEADINGS */
        .section-heading { 
            font-size: 11px; font-weight: 900; text-transform: uppercase; letter-spacing: 0.5px; 
            border-left: 4px solid #000; padding-left: 10px; margin: 30px 0 15px 0; color: #000;
        }

        /* TABLE */
        table { width: 100%; border-collapse: collapse; font-size: 10px; font-family: 'Courier New', Courier, monospace; }
        th { text-align: left; border-bottom: 2px solid #000; padding: 8px 0; text-transform: uppercase; font-weight: bold; }
        td { border-bottom: 1px solid #eee; padding: 10px 0; color: #333; }
        .pass-badge { color: #008000; font-weight: bold; }
        .hash-code { color: #555; }

        /* LOG */
        .system-log { 
            background: #111; color: #32CD32; padding: 15px; 
            font-family: 'Courier New', Courier, monospace; font-size: 9px; 
            border-radius: 4px; margin-top: 20px; line-height: 1.6; 
        }

        /* FOOTER */
        .doc-footer { margin-top: 60px; border-top: 1px solid #000; padding-top: 20px; display: flex; justify-content: space-between; align-items: flex-end; }
        /* Simple CSS Barcode */
        .barcode { height: 35px; width: 180px; background: repeating-linear-gradient(90deg, #000, #000 2px, #fff 2px, #fff 4px); margin-top: 10px; }
        
        .auth-sign { text-align: right; }
        .sign-placeholder { font-weight: 900; font-size: 14px; color: #000; text-transform: uppercase; margin-bottom: 5px; }

    </style>
</head>
<body>

    <div id="statusOverlay">Please wait... Generating Report...</div>

    <div class="manifest-paper" id="invoice">
        
        <header class="doc-header">
            <div class="brand-section">
                <div class="status-tag">Deployment Successful</div>
                <h1>Advora Tech</h1>
                <span class="subtitle">System Release Manifest & Audit Log</span>
            </div>
            <div class="meta-box">
                <div>DOC ID: <span id="docId">...</span></div>
                <div>DATE: <span id="printDate">...</span></div>
                <div>ENV: PRODUCTION (ARM64)</div>
                <div>AUTH: ADMIN_ROOT</div>
            </div>
        </header>

        <div class="tech-grid">
            <div class="data-point">
                <label>Release Version</label>
                <div id="verNum">...</div>
            </div>
            <div class="data-point">
                <label>Artifact ID</label>
                <div id="buildId">...</div>
            </div>
            <div class="data-point">
                <label>Required Ver</label>
                <div id="minVer">...</div>
            </div>
            <div class="data-point">
                <label>Database Sync</label>
                <div>COMPLETED (Write: 1)</div>
            </div>
            <div class="data-point">
                <label>Deployment Date</label>
                <div id="deployDate">...</div>
            </div>
            <div class="data-point">
                <label>Integrity Check</label>
                <div>SHA-256 PASSED</div>
            </div>
        </div>

        <div class="section-heading">/// PIPELINE EXECUTION LOG</div>
        <table>
            <thead>
                <tr>
                    <th>Process Phase</th>
                    <th>Hash</th>
                    <th>Timestamp</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>Build & Signing</td><td class="hash-code" id="h1"></td><td id="t1"></td><td class="pass-badge">[ OK ]</td></tr>
                <tr><td>Asset Upload</td><td class="hash-code" id="h2"></td><td id="t2"></td><td class="pass-badge">[ OK ]</td></tr>
                <tr><td>Config Overwrite</td><td class="hash-code" id="h3"></td><td id="t3"></td><td class="pass-badge">[ OK ]</td></tr>
                <tr><td>Redirect Simulation</td><td class="hash-code" id="h4"></td><td id="t4"></td><td class="pass-badge">[ OK ]</td></tr>
            </tbody>
        </table>

        <div class="section-heading">/// TERMINAL OUTPUT</div>
        <div class="system-log">
            > Initiating handshake with Cloud Config... OK<br>
            > Verifying User Permissions... AUTHENTICATED<br>
            > Updating 'min_supported_version' pointer... SUCCESS<br>
            > Running redirect simulation (splash.html -> block.html)... PASS<br>
            > Closing session. Deployment finalized.
        </div>

        <footer class="doc-footer">
            <div>
                <div style="font-size: 8px; text-transform: uppercase; color: #555; margin-bottom: 5px;">Digital Identity</div>
                <div class="barcode"></div>
                <div style="font-family: 'Courier New', monospace; font-size: 8px; margin-top: 4px;">ID: <span id="guid">...</span></div>
            </div>
            <div class="auth-sign">
                <div class="sign-placeholder">Lunor Tech Systems</div>
                <div style="font-size: 8px; text-transform: uppercase; color: #555;">Verified Deployment Authority</div>
            </div>
        </footer>

    </div>

    <script>
        function randomHex(len) {
            const chars = '0123456789ABCDEF';
            let res = '';
            for(let i=0; i<len; i++) res += chars[Math.floor(Math.random() * chars.length)];
            return res;
        }

        window.onload = function() {
            // 1. Get Params
            const params = new URLSearchParams(window.location.search);
            const ver = params.get('v') || 'v0.0.0';
            const depDate = params.get('d') || 'Unknown';
            
            // 2. Fill Data
            document.getElementById('verNum').innerText = ver;
            document.getElementById('minVer').innerText = ver;
            document.getElementById('deployDate').innerText = depDate;
            document.getElementById('printDate').innerText = new Date().toLocaleDateString();
            document.getElementById('docId').innerText = "DOC-" + randomHex(6);
            document.getElementById('buildId').innerText = `B-${new Date().getFullYear()}-${randomHex(4)}`;
            document.getElementById('guid').innerText = Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);

            const now = new Date();
            for(let i=1; i<=4; i++) {
                document.getElementById(`h${i}`).innerText = "0x" + randomHex(8);
                document.getElementById(`t${i}`).innerText = new Date(now - (i*5000)).toISOString().split('T')[1].split('.')[0] + "Z";
            }

            // 3. WAIT & PRINT (Wait 1s for layout to settle)
            setTimeout(() => {
                const element = document.getElementById('invoice');
                const opt = {
                    margin: 0,
                    filename: `Release_Manifest_${ver}.pdf`,
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { scale: 2, useCORS: true },
                    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
                };

                html2pdf().set(opt).from(element).save().then(() => {
                    document.getElementById('statusOverlay').innerText = "✅ PDF Downloaded. You can close this tab.";
                    document.getElementById('statusOverlay').style.background = "#006400";
                }).catch(err => {
                    document.getElementById('statusOverlay').innerText = "❌ Error: " + err.message;
                });
            }, 1000); 
        };
    </script>
</body>
    </html>
            
